{"version":3,"file":"client.js","sourceRoot":"","sources":["../client.ts"],"names":[],"mappings":"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","sourcesContent":["// Sol√∏ API client\n\nexport interface DebugInfo {\n\tserver?: ServerInfo | null;\n\tip?:     IPInfo | null;\n\thttp?:   HTTPInfo | null;\n\ttls?:    TLSInfo | null;\n}\n\nexport interface JSONError {\n\tmessages:  string[];\n}\n\nexport interface Task {\n\tid?:         string | null;\n\tetag?:       string | null;\n\tgeneration?: number | null;\n\tuserID?:     string | null;\n\tname?:       string | null;\n\tcomplete?:   boolean | null;\n\tafter?:      string | null;\n}\n\nexport interface Token {\n\tid?:         string | null;\n\tetag?:       string | null;\n\tgeneration?: number | null;\n\tuserID?:     string | null;\n\ttoken?:      string | null;\n}\n\nexport interface User {\n\tid?:           string | null;\n\tetag?:         string | null;\n\tgeneration?:   number | null;\n\tname?:         string | null;\n\temail?:        string | null;\n\tpassword?:     string | null;\n\tserviceAdmin?: boolean | null;\n}\n\nexport interface ServerInfo {\n\thostname:  string;\n}\n\nexport interface IPInfo {\n\tremoteAddr:  string;\n}\n\nexport interface HTTPInfo {\n\tprotocol:  string;\n\tmethod:    string;\n\theader:    string;\n\turl:       string;\n}\n\nexport interface TLSInfo {\n\tversion:             number;\n\tdidResume:           boolean;\n\tcipherSuite:         number;\n\tnegotiatedProtocol:  string;\n\tserverName:          string;\n}\n\nexport class Client {\n\tprivate baseURL: URL;\n\tprivate headers: Headers = new Headers();\n\n\tconstructor(baseURL: string) {\n\t\tthis.baseURL = new URL(baseURL);\n\t}\n\n\tsetBasicAuth(user: string, pass: string) {\n\t\tconst enc = btoa(`${user}:${pass}`);\n\t\tthis.headers.set('Authorization', `Basic ${enc}`);\n\t}\n\n\tsetAuthToken(token: string) {\n\t\tthis.headers.set('Authorization', `Bearer ${token}`);\n\t}\n\n\tasync debugInfo(): Promise<DebugInfo> {\n\t\treturn this.fetch('GET', '_debug');\n\t}\n\n\t//// Task\n\n\tasync createTask(obj: Task): Promise<Task> {\n\t\treturn this.createName(\"task\", obj);\n\t}\n\n\t// TODO: Add UpdateOpts\n\tasync deleteTask(id: string): Promise<void> {\n\t\treturn this.deleteName(\"task\", id);\n\t}\n\n\t// TODO: Add fetch*()\n\n\t// TODO: Add GetOpts\n\tasync getTask(id: string): Promise<Task> {\n\t\treturn this.getName(\"task\", id);\n\t}\n\n\t// TODO: Add ListOpts\n\tasync listTask(): Promise<Task[]> {\n\t\treturn this.listName(\"task\");\n\t}\n\n\t// TODO: Add UpdateOpts\n\tasync replaceTask(id: string, obj: Task): Promise<Task> {\n\t\treturn this.replaceName(\"task\", id, obj);\n\t}\n\n\t// TODO: Add UpdateOpts\n\tasync updateTask(id: string, obj: Task): Promise<Task> {\n\t\treturn this.updateName(\"task\", id, obj);\n\t}\n\n\t// TODO: Add streamGet\n\t// TODO: Add streamList\n\n\t//// Token\n\n\tasync createToken(obj: Token): Promise<Token> {\n\t\treturn this.createName(\"token\", obj);\n\t}\n\n\t// TODO: Add UpdateOpts\n\tasync deleteToken(id: string): Promise<void> {\n\t\treturn this.deleteName(\"token\", id);\n\t}\n\n\t// TODO: Add fetch*()\n\n\t// TODO: Add GetOpts\n\tasync getToken(id: string): Promise<Token> {\n\t\treturn this.getName(\"token\", id);\n\t}\n\n\t// TODO: Add ListOpts\n\tasync listToken(): Promise<Token[]> {\n\t\treturn this.listName(\"token\");\n\t}\n\n\t// TODO: Add UpdateOpts\n\tasync replaceToken(id: string, obj: Token): Promise<Token> {\n\t\treturn this.replaceName(\"token\", id, obj);\n\t}\n\n\t// TODO: Add UpdateOpts\n\tasync updateToken(id: string, obj: Token): Promise<Token> {\n\t\treturn this.updateName(\"token\", id, obj);\n\t}\n\n\t// TODO: Add streamGet\n\t// TODO: Add streamList\n\n\t//// User\n\n\tasync createUser(obj: User): Promise<User> {\n\t\treturn this.createName(\"user\", obj);\n\t}\n\n\t// TODO: Add UpdateOpts\n\tasync deleteUser(id: string): Promise<void> {\n\t\treturn this.deleteName(\"user\", id);\n\t}\n\n\t// TODO: Add fetch*()\n\n\t// TODO: Add GetOpts\n\tasync getUser(id: string): Promise<User> {\n\t\treturn this.getName(\"user\", id);\n\t}\n\n\t// TODO: Add ListOpts\n\tasync listUser(): Promise<User[]> {\n\t\treturn this.listName(\"user\");\n\t}\n\n\t// TODO: Add UpdateOpts\n\tasync replaceUser(id: string, obj: User): Promise<User> {\n\t\treturn this.replaceName(\"user\", id, obj);\n\t}\n\n\t// TODO: Add UpdateOpts\n\tasync updateUser(id: string, obj: User): Promise<User> {\n\t\treturn this.updateName(\"user\", id, obj);\n\t}\n\n\t// TODO: Add streamGet\n\t// TODO: Add streamList\n\n\t//// Generic\n\n\tasync createName<T>(name: string, obj: T): Promise<T> {\n\t\treturn this.fetch('POST', encodeURIComponent(name), obj);\n\t}\n\n\t// TODO: Add UpdateOpts\n\tasync deleteName(name: string, id: string): Promise<void> {\n\t\treturn this.fetch('DELETE', `${encodeURIComponent(name)}/${encodeURIComponent(id)}`);\n\t}\n\n\t// TODO: Add findName()\n\n\t// TODO: Add GetOpts\n\tasync getName<T>(name: string, id: string): Promise<T> {\n\t\treturn this.fetch('GET', `${encodeURIComponent(name)}/${encodeURIComponent(id)}`);\n\t}\n\n\t// TODO: Add ListOpts\n\tasync listName<T>(name: string): Promise<T[]> {\n\t\treturn this.fetch('GET', `${encodeURIComponent(name)}`);\n\t}\n\n\t// TODO: Add UpdateOpts\n\tasync replaceName<T>(name: string, id: string, obj: T): Promise<T> {\n\t\treturn this.fetch('PUT', `${encodeURIComponent(name)}/${encodeURIComponent(id)}`, obj);\n\t}\n\n\t// TODO: Add UpdateOpts\n\tasync updateName<T>(name: string, id: string, obj: T): Promise<T> {\n\t\treturn this.fetch('PATCH', `${encodeURIComponent(name)}/${encodeURIComponent(id)}`, obj);\n\t}\n\n\t// TODO: Add streamGetName\n\t// TODO: Add streamListName\n\n\tprivate async fetch(method: string, path: string, body?: any): Promise<any> {\n\t\tconst url = new URL(path, this.baseURL);\n\n\t\tconst opts: RequestInit = {\n\t\t\tmethod: method,\n\t\t\theaders: new Headers(this.headers),\n\t\t\tmode: 'cors',\n\t\t\tcredentials: 'omit',\n\t\t\treferrerPolicy: 'no-referrer',\n\t\t\tkeepalive: true,\n\t\t}\n\n\t\tif (body) {\n\t\t\topts.body = JSON.stringify(body);\n\t\t\t(<Headers>opts.headers).set('Content-Type', 'application/json');\n\t\t}\n\n\t\tconst req = new Request(url, opts);\n\n\t\tconst resp = await fetch(req);\n\t\tif (!resp.ok) {\n\t\t\tthrow new Error(await resp.json());\n\t\t}\n\n\t\tif (resp.status == 200) {\n\t\t\treturn resp.json();\n\t\t}\n\t}\n}\n\nexport class Error {\n\tmessages: string[];\n\n\tconstructor(json: JSONError) {\n\t\tthis.messages = json.messages;\n\t}\n\n\ttoString(): string {\n\t\treturn this.messages[0] ?? 'error';\n\t}\n}\n"]}